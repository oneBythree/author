"use strict";function isToday(t){var e=new Date,a=new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()/1e3,i=parseInt(t);return a==i}Vue.filter("user_route_time",function(t){var e=new Date(1e3*t),a=moment(e);return a.format("MM月DD H:mm")}),Vue.config.delimiters=["@{","}"];var app=new Vue({el:"body",data:function(){return{items:[],page:0,pagetotal:0}},ready:function(){this.getPulishRouteList()},methods:{getPulishRouteList:function(){var t=this;postJson("/api/lines/route/mine/listing",function(e){$.each(e.data.data,function(t,a){$.each(a.routes,function(a,i){isToday(i.startDate)?e.data.data[t].routes[a].startDate="今天":e.data.data[t].routes[a].startDate=Context.getZhDateMin(i.startDate).split(" ")[0],e.data.data[t].routes[a].startTime=Context.getTime(i.startTime)})}),t.$set("items",e.data.data),t.$set("page",e.data.page),t.$set("pagetotal",e.data.pagetotal)})},changeTag:function(t,e,a){var i=t,s=$(a.target),o="";o=s.hasClass("active")?1==e?"0,1":"0,2":1==e?"1,1":"1,2",postForm("/api/lines/route/mine/tag",{routeid:i,action:o},function(t){s.siblings().removeClass("active"),s.hasClass("active")?(s.removeClass("active"),$.ModuleTip({txt:"已取消标签"})):(s.addClass("active"),$.ModuleTip({txt:"设置标签成功"}))})},delPuhlishRoute:function(t,e){var a=$(event.target).parents("ul"),i=$(event.target).parents("li"),s=a.attr("data-length");postForm("/api/lines/route/mine/cancel",{routeid:t},function(t){1==s?a.remove():i.remove(),$.ModuleTip({txt:"删除成功"})})},moreList:function(t){var e=this;t+1>this.pagetotal?$(".u-more").hide():postForm("/api/lines/route/mine/listing",{page:t+1},function(t){$.each(t.data.data,function(a,i){$.each(i.routes,function(i,s){isToday(s.startDate)?t.data.data[a].routes[i].startDate="今天":t.data.data[a].routes[i].startDate=Context.getZhDateMin(s.startDate).split(" ")[0],t.data.data[a].routes[i].startTime=Context.getTime(s.startTime),e.items.push(t.data.data[a])})}),e.page=t.data.page,e.pagetotal=t.data.pagetotal})},isDriver:function(t){return"undefined"==typeof t?1:t.routes[0].routeinfo.is_driver},updateRoute:function(t){var e=this,a=new Date,i="/api/routes/update",s={driver_route_id:t.routes[0].id};$.post(i,s,function(i){if("1"!=i.codee)return void mui.toast(i.message);var s=e.items.indexOf(t);e.items.splice(s,1),t.routes[0].updated_at=a.getTime()/1e3,e.items.unshift(t),mui.toast("刷新置顶成功")})}}});